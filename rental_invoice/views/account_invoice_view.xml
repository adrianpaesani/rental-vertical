<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="invoice_form" model="ir.ui.view">
        <field name="name">account.invoice.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form" />
        <field name="arch" type="xml">
            <xpath expr="//group[field[@name='date_invoice']]" position="inside">
                <field name="origin_invoice" attrs="{'invisible': [('origin_invoice', '=', False)]}"/>
            </xpath>
        </field>
    </record>

    <record id="invoice_supplier_form" model="ir.ui.view">
        <field name="name">account.invoice.supplier.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form" />
        <field name="arch" type="xml">
            <xpath expr="//notebook/preceding-sibling::div[1]" position="before">
                <div class="oe_button_box" name="button_box">
                    <button
                        name="action_view_forward_invoices"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': [('forward_invoice_count', '=', 0)]}">
                        <field name="forward_invoice_count" widget="statinfo" string="Forward Invoices" />
                    </button>
                </div>
            </xpath>
            <header position="inside">
                <button
                    name="action_clarify_needed"
                    string="To clarify"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('clarify_needed', '=', True)]}"
                    groups="rental_invoice.group_set_checks_finished"
                    confirm="Are you sure you want to set clarify needed and checks finished?"
                />
                <button
                    name="action_clarify_needed"
                    string="To clarify"
                    type="object"
                    attrs="{'invisible': ['|', ('state', '!=', 'open'), ('clarify_needed', '=', True)]}"
                    groups="rental_invoice.group_set_checks_finished"
                    confirm="Are you sure you want to set clarify needed and checks finished?"
                />
                <button
                    name="action_clarify_completed"
                    string="Clarify completed"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', ('state', 'not in', ('draft', 'open', 'done')), ('clarify_needed', '=', False)]}"
                    groups="rental_invoice.group_set_checks_finished"
                    confirm="Are you sure you want to set clarify completed?"
                />
                <button
                    name="action_checks_finished"
                    string="Checks finished"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('checks_finished', '=', True)]}"
                    groups="rental_invoice.group_set_checks_finished"
                    confirm="Are you sure you want to set checks finished?"
                />
                <button
                    name="action_payment_release"
                    string="Release payment"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', '|', ('state', '!=', 'open'), ('payment_release', '=', True), ('clarify_needed', '=', True)]}"
                    groups="rental_invoice.group_set_payment_release"
                    confirm="Are you sure you want to set payment release?"
                />
                <button
                    name="action_payment_release"
                    string="Release payment"
                    type="object"
                    attrs="{'invisible': ['|', '|',('state', '!=', 'open'), ('payment_release', '=', True), ('clarify_needed', '=', False)]}"
                    groups="rental_invoice.group_set_payment_release"
                    confirm="This vendor bill is in the state 'Clarify'; are you sure you want to set payment release?"
                />
                <button
                    name="action_refund_needed"
                    string="Refund needed"
                    type="object"
                    attrs="{'invisible': ['|',('state', 'not in', ('draft', 'open')), ('refund_needed', '=', True)]}"
                    confirm="Are you sure you want to set refund needed?"
                />
                <button
                    name="%(rental_invoice.action_create_forward_invoice)d"
                    string="Create Forward Invoice"
                    type="action"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', ('forward_invoice_needed', '=', False), ('has_non_canceled_forward_invoices', '=', True)]}"
                    groups="rental_invoice.group_create_forward_invoice_from_vendor_bill"
                    confirm="Are you sure you want to create an forward invoice from this vendor bill?"
                />
            </header>
            <button name="action_invoice_open" position="attributes">
                <attribute name="states"></attribute>
                <attribute name="attrs">
                    {'invisible': [
                        '|',
                        ('state', '!=', 'draft'),
                        ('checks_finished', '=', False),
                    ]}
                </attribute>
            </button>
            <button name="%(account.action_account_invoice_payment)d" position="attributes">
                <attribute name="states"></attribute>
                <attribute name="attrs">
                    {'invisible': [
                        '|',
                        '&amp;',
                        ('forward_invoice_needed', '=', True),
                        ('has_non_canceled_forward_invoices', '=', False),
                        '|',
                        ('state', '!=', 'open'),
                        ('payment_release', '=', False),
                    ]}
                </attribute>
            </button>
            <button name="%(account.action_account_invoice_refund)d" position="attributes">
                <attribute name="states"></attribute>
                <attribute name="attrs">
                    {'invisible': [
                        '|',
                        ('type', 'in', ['in_refund','out_refund']),
                        ('state', 'not in', ('open', 'in_payment','paid'))
                    ]}
                </attribute>
            </button>
            <xpath expr="//group[field[@name='incoterm_id']]" position="inside">
                <field name="forward_invoice_needed" attrs="{'readonly': [
                    '|',
                    '&amp;',
                    ('has_non_canceled_forward_invoices', '=', True),
                    ('forward_invoice_needed', '=', True),
                    ('state', 'not in', ('draft', 'open')),
                ]}" />
                <field name="has_non_canceled_forward_invoices" invisible="1" />
                <field name="clarify_needed" readonly="1" />
                <field name="checks_finished" readonly="1" />
                <field name="payment_release" readonly="1" />
                <field name="refund_needed" readonly="1" />
            </xpath>
        </field>
    </record>

    <record id="invoice_supplier_form_reset_invoice_checks" model="ir.ui.view">
        <field name="name">account.invoice.supplier.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="invoice_supplier_form" />
        <field name="groups_id" eval="[(4, ref('group_reset_invoice_checks'))]"/>
        <field name="arch" type="xml">
            <field name="clarify_needed" position="attributes">
                <attribute name="readonly"></attribute>
                <attribute name="attrs">
                    {'readonly': [
                        '|',
                        ('state', 'not in', ('draft', 'open', 'done')),
                        ('clarify_needed', '=', False),
                    ]}
                </attribute>
            </field>
            <field name="checks_finished" position="attributes">
                <attribute name="readonly"></attribute>
                <attribute name="attrs">
                    {'readonly': [
                        '|',
                        ('state', '!=', 'draft'),
                        ('checks_finished', '=', False),
                    ]}
                </attribute>
            </field>
            <field name="payment_release" position="attributes">
                <attribute name="readonly"></attribute>
                <attribute name="attrs">
                    {'readonly': [
                        '|',
                        ('state', '!=', 'open'),
                        ('payment_release', '=', False),
                    ]}
                </attribute>
            </field>
            <field name="refund_needed" position="attributes">
                <attribute name="readonly"></attribute>
                <attribute name="attrs">
                    {'readonly': [
                        '|',
                        ('state', 'not in', ('draft', 'open')),
                        ('refund_needed', '=', False),
                    ]}
                </attribute>
            </field>
        </field>
    </record>

    <record id="view_account_invoice_filter" model="ir.ui.view">
        <field name="name">account.invoice.select</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter" />
        <field name="arch" type="xml">
            <search position="inside">
                <filter name="clarify_needed" string="Clarify needed" domain="[('clarify_needed','=',True)]" />
                <filter name="checks_finished" string="Checks finished" domain="[('checks_finished','=',True)]" />
                <filter name="payment_release" string="Payment release" domain="[('payment_release','=',True)]" />
            </search>
        </field>
    </record>
</odoo>
